/* =========================================================
   00 — ROOT CONTROLS
   ========================================================= */

   :root{
    /* UI */
    --header-top: 24px;
  
    /* Foreground opacity (tree + text + nav) */
    --fg-opacity: 0.7;
  
    /* Underlay loop */
    --underlay-loop: 30s;
    --underlay-opacity: 7.0;
  
    /* Underlay composition bias */
    --underlay-shift-x: 0vw; /* push right if needed: 8vw / 12vw */
  }
  
  /* =========================================================
     01 — RESET / BASE
     ========================================================= */
  
  *{ box-sizing: border-box; }
  
  html, body{
    width: 100%;
    height: 100%;
    margin: 0;
    padding: 0;
  }
  
  body{
    background: #000;
    color: #fff;
    overflow: hidden;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  }
  
  /* =========================================================
     02 — LAYERS
     underlay (0) < canvas tree (1) < handwriting/title (2) < nav (3)
     ========================================================= *
  
  /* =========================================================
     03 — TREE CANVAS (Babylon)
     ========================================================= */
  
  #renderCanvas{
    position: fixed;
    inset: 0;
    width: 100%;
    height: 100%;
    display: block;
    z-index: 1;
    opacity: var(--fg-opacity);
    image-rendering: pixelated;
    image-rendering: crisp-edges;
    pointer-events: auto;
  }
  
  /* NOTE:
     If you ever see the canvas “shift” or blur, make sure you do NOT
     put CSS transforms on #renderCanvas or its parents. */
  
  /* =========================================================
     04 — TITLE
     ========================================================= */
  
  .site-header{
    position: fixed;
    top: var(--header-top);
    left: 50%;
    transform: translateX(-50%);
    z-index: 2;
  
    font-family: "Estonia", serif;
    font-size: 28px;
    letter-spacing: 0.15em;
    text-transform: lowercase;
    font-weight: 400;
  
    opacity: var(--fg-opacity);
    pointer-events: none;
    user-select: none;
  }
  
  @media (max-width: 480px){
    :root{ --header-top: 18px; }
  }
  
  /* =========================================================
     05 — NAV
     ========================================================= */
  
  .nav{
    position: fixed;
    inset: 0 0 auto 0;
    height: 56px;
    padding: 0 18px;
    z-index: 3;
  
    display: flex;
    align-items: center;
    justify-content: space-between;
  
    background: transparent;
    color: #fff;
  
    opacity: var(--fg-opacity);
  }
  
  .nav__brand{
    font-family: "Estonia", serif;
    font-size: 28px;
    letter-spacing: 0.12em;
    text-transform: lowercase;
    font-weight: 400;
  }
  
  .nav__links{
    display: flex;
    gap: 18px;
  }
  
  .nav a{
    font-family: "Estonia", serif;
    font-size: 22px;
    letter-spacing: 0.08em;
    text-transform: lowercase;
  
    color: inherit;
    text-decoration: none;
  
    opacity: 0.85;
    transition: opacity 120ms ease;
  }
  
  .nav a:hover{ opacity: 1; }
  
  @media (max-width: 640px){
    .nav{
      height: 52px;
      padding: 0 14px;
    }
    .nav a{
      font-size: 20px;
      letter-spacing: 0.05em;
    }
  }


  /* =========================================================
   07 — HANDWRITING
   ========================================================= */

   .handwriting{
    position: fixed;
    left: 275px;
    top: 80px;
    bottom: 40px;
    width: 320px;
  
    z-index: 10;                /* above tree + underlay */
    pointer-events: none;
  
    isolation: isolate;         /* isolate from blend/compositing */
    transform: translateZ(0);   /* force its own GPU layer */
    will-change: transform;
  
    opacity: 0.7;                 /* IMPORTANT: don’t fade the whole layer */
  }
  
  
  .handwriting__svg{
    width: 100%;
    height: 100%;
    overflow: visible; 
  }
  
  .hw{
    font-family: "Estonia", serif;
    font-size: 45px;
  
    fill: transparent;
    stroke: rgba(255,255,255,0.92);
    stroke-width: 1.3;
    stroke-linecap: round;
    stroke-linejoin: round;
  
    /* IMPORTANT: remove the filter that causes shimmer */
    filter: none;
  
    /* Optional: keep it crisp */
    shape-rendering: geometricPrecision;
  
    stroke-dasharray: 900;
    stroke-dashoffset: 900;
  
    animation:
      draw 40s ease-in-out forwards,
      fill 10s ease-in forwards;
  
    animation-delay:
      var(--d, 0s),
      calc(var(--d, 0s) + 32s);
  }


  .handwriting__svg{ position: relative; z-index: 1; }
  
  /* draw & fill animations */
  @keyframes draw{
    to{ stroke-dashoffset: 0; }
  }
  
  @keyframes fill{
    to{ fill: rgba(255,255,255,.18); }
  }
  
  /* =========================================================
     LINE-BY-LINE STAGGER
     ========================================================= */
  
  .handwriting__svg .hw:nth-of-type(1){ --d: 0s; }
  .handwriting__svg .hw:nth-of-type(2){ --d: 1s; }
  .handwriting__svg .hw:nth-of-type(3){ --d: 2s; }
  .handwriting__svg .hw:nth-of-type(4){ --d: 3s; }
  .handwriting__svg .hw:nth-of-type(5){ --d: 4s; }
  .handwriting__svg .hw:nth-of-type(6){ --d: 5s; }
  .handwriting__svg .hw:nth-of-type(7){ --d: 6s; }
  .handwriting__svg .hw:nth-of-type(8){ --d: 7s; }
  



/* =========================================================
   06 — UNDERLAY (ORNATE INK, STABLE LOOP)
   ========================================================= */

:root{
    --underlay-loop: 30s;
    --underlay-opacity: 0.22;
    --underlay-shift-x: 0vw;
  }
  
  .underlay{
    position: fixed;
    inset: 0;
    z-index: 0;
    pointer-events: none;
    overflow: visible;
  }
  
  /* =========================================================
     LIFE CYCLE
     center → appear → drift → dissolve → hard reset
     ========================================================= */
  
  @keyframes underlayLife{
    /* invisible, centered */
    0%{
      opacity: 0;
      transform:
        translate3d(-50%, -50%, 0)
        translate3d(var(--tx), var(--ty), 0)
        rotate(var(--r))
        scale(var(--s));
    }
  
    /* appear quickly */
    6%{
      opacity: var(--u);
    }
  
    /* hold */
    30%{
      opacity: var(--u);
    }
  
    /* drift */
    70%{
      opacity: calc(var(--u) * 0.75);
      transform:
        translate3d(-50%, -50%, 0)
        translate3d(
          calc(var(--tx) + var(--dx)),
          calc(var(--ty) + var(--dy)),
          0
        )
        rotate(var(--r))
        scale(var(--s));
    }
  
    /* fade out while drifting */
    88%{
      opacity: 0;
    }
  
    /* HARD RESET — invisible teleport */
    100%{
      opacity: 0;
      transform:
        translate3d(-50%, -50%, 0)
        translate3d(var(--tx), var(--ty), 0)
        rotate(var(--r))
        scale(var(--s));
    }
  }
  
  /* slow ambient spin (separate = stable) */
  @keyframes underlaySpin{
    from{ rotate: 0deg; }
    to{ rotate: calc(360deg * var(--dir)); }
  }
  
  /* =========================================================
     IMAGE BASE
     ========================================================= */
  
  .underlay__img{
    position: absolute;
    left: 50%;
    top: 50%;
  
    width: 140vmax;
    height: 140vmax;
    object-fit: contain;
  
    mix-blend-mode: screen;
    opacity: 0;
  
    transform-origin: var(--ox) var(--oy);
  
    /* static ink blot mask (NO animation = stability) */
    -webkit-mask-image:
      radial-gradient(circle at 18% 26%, #000 0 14%, transparent 18%),
      radial-gradient(circle at 54% 24%, #000 0 18%, transparent 22%),
      radial-gradient(circle at 72% 44%, #000 0 12%, transparent 16%),
      radial-gradient(circle at 32% 66%, #000 0 20%, transparent 24%),
      radial-gradient(circle at 64% 74%, #000 0 16%, transparent 20%);
    mask-image: -webkit-mask-image;
  
    -webkit-mask-repeat: no-repeat;
    mask-repeat: no-repeat;
    -webkit-mask-position: center;
    mask-position: center;
    -webkit-mask-size: 160% 160%;
    mask-size: 160% 160%;
  
    /* IMPORTANT: no animated filter */
    filter: blur(0.4px) contrast(1.05);
  
    animation:
      underlayLife var(--underlay-loop) linear infinite,
      underlaySpin var(--rotDur) linear infinite;
  
    animation-delay: var(--delay), 0s;
  
    will-change: transform, opacity;
    backface-visibility: hidden;
  }
  
  /* =========================================================
     COMPOSITION — DIFFERENT SCALES / DIRECTIONS / DRIFTS
     ========================================================= */
  
  .underlay__img:nth-child(1){
    --u:.22;
    --tx:-12vw; --ty:-8vh;
    --dx:220px; --dy:-180px;
    --s:.92; --r:-2deg;
    --ox:30%; --oy:32%;
    --dir:1; --rotDur:240s;
    --delay:0s;
  }
  .underlay__img:nth-child(2){
    --u:.20;
    --tx:16vw; --ty:-10vh;
    --dx:-240px; --dy:200px;
    --s:.88; --r:3deg;
    --ox:72%; --oy:28%;
    --dir:-1; --rotDur:360s;
    --delay:-5s;
  }
  .underlay__img:nth-child(3){
    --u:.18;
    --tx:-6vw; --ty:14vh;
    --dx:180px; --dy:260px;
    --s:.86; --r:1deg;
    --ox:40%; --oy:78%;
    --dir:1; --rotDur:300s;
    --delay:-10s;
  }
  .underlay__img:nth-child(4){
    --u:.16;
    --tx:20vw; --ty:10vh;
    --dx:-260px; --dy:-200px;
    --s:.84; --r:-4deg;
    --ox:86%; --oy:54%;
    --dir:-1; --rotDur:480s;
    --delay:-15s;
  }
  .underlay__img:nth-child(5){
    --u:.14;
    --tx:2vw; --ty:0vh;
    --dx:210px; --dy:-170px;
    --s:.78; --r:-1deg;
    --ox:52%; --oy:52%;
    --dir:1; --rotDur:380s;
    --delay:-20s;
  }
  .underlay__img:nth-child(6){
    --u:.12;
    --tx:-18vw; --ty:18vh;
    --dx:-220px; --dy:190px;
    --s:.82; --r:4deg;
    --ox:18%; --oy:72%;
    --dir:-1; --rotDur:520s;
    --delay:-25s;
  }
  .underlay__img:nth-child(7){
    --u:.10;
    --tx:10vw; --ty:22vh;
    --dx:170px; --dy:-260px;
    --s:.80; --r:-2deg;
    --ox:64%; --oy:86%;
    --dir:1; --rotDur:460s;
    --delay:-28s;
  }
  

  /* =========================================================
   AUDIO TOGGLE (matches nav)
   ========================================================= */
   .audio-toggle{
    position: fixed;
    top: 12px;
    left: 18px;
    z-index: 9999;          /* higher than nav/canvas/underlay */
    pointer-events: auto;   /* make sure it can be clicked */
  
    font-family: "Estonia", serif;
    font-size: 22px;
    letter-spacing: 0.08em;
    text-transform: lowercase;
  
    color: #fff;
    opacity: var(--fg-opacity);
    cursor: pointer;
    user-select: none;
  }
  
  .underlay,
  #renderCanvas{
    pointer-events: none;   /* ensures they never steal clicks */
  }
  

  #renderCanvas {
    pointer-events: none;
  }

  .handwriting {
    position: relative;
    z-index: 50;
    pointer-events: auto;
  }
  
  .handwriting__svg {
    pointer-events: auto;
  }
  
  .hw-link, .hw-link text {
    pointer-events: auto;
    cursor: pointer;
  }

  .handwriting__svg a {
    cursor: pointer;
  }
  
  .handwriting__svg a:hover text {
    text-decoration: underline;
  }



  .open-map-btn {



    position: fixed;
    top: var(--header-top);
    left: 334px;
    top: 680px;
    transform: translateX(-50%);
    z-index: 99999;
    font-family: "Estonia", serif;
    font-size: 28px;
    letter-spacing: 0.15em;
    text-transform: lowercase;
    font-weight: 400;
    opacity: 70%;
    user-select: none;
  }



  /* =========================================================
   MAP PAGE 
   ========================================================= */

   #bgVideo{
    position: fixed;
    inset: 0;
    width: 100vw;
    height: 100vh;
    object-fit: cover;
    object-position: center;
    z-index: -10;
    pointer-events: none;
    background: #000;
    opacity: 50%;
  }
  
  .map{
    width: 300px;
    height: auto; /* keeps aspect ratio */
    margin-top: 350px;
    margin-left: 150px;
    position: absolute;
    z-index: 1;
  
  }



.rose1{
    width: 200px;
    margin-top: 50px;
    margin-left: 950px;
    position: absolute;
    z-index: 2;
    
}

.rose2{
    width: 200px;
    margin-top: 50px;
    margin-left: 1050px;
    position: absolute;
    z-index: 2;
    
}

.rose3{
    width: 200px;
    margin-top: 50px;
    margin-left: 1150px;
    position: absolute;
    z-index: 2;
    
}


.rose1, .rose2, .rose3, .map {
    filter:
      drop-shadow(1px 0 black)
      drop-shadow(-1px 0 black)
      drop-shadow(0 1px black)
      drop-shadow(0 -1px black);
}


.rose2,
.rose3 {
    filter: grayscale(100%);
}

.treemap {
    width: 200px;
    margin-top: 50px;
    margin-left: 1050px;
    position: absolute;
    z-index: 2;
}
  