/* =========================================================
   00 — ROOT CONTROLS
   ========================================================= */

   :root{
    /* UI */
    --header-top: 24px;
  
    /* Foreground opacity (tree + text + nav) */
    --fg-opacity: 0.7;
  
    /* Underlay loop */
    --underlay-loop: 30s;
    --underlay-opacity: 7.0;
  
    /* Underlay composition bias */
    --underlay-shift-x: 0vw; /* push right if needed: 8vw / 12vw */
  }
  
  /* =========================================================
     01 — RESET / BASE
     ========================================================= */
  
  *{ box-sizing: border-box; }
  
  html, body{
    width: 100%;
    height: 100%;
    margin: 0;
    padding: 0;
  }
  
  body{
    background: #000;
    color: #fff;
    overflow: hidden;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  }
  
  /* =========================================================
     02 — LAYERS
     underlay (0) < canvas tree (1) < handwriting/title (2) < nav (3)
     ========================================================= *
  
  /* =========================================================
     03 — TREE CANVAS (Babylon)
     ========================================================= */
  
  #renderCanvas{
    position: fixed;
    inset: 0;
    width: 100%;
    height: 100%;
    display: block;
    z-index: 1;
    opacity: var(--fg-opacity);
    image-rendering: pixelated;
    image-rendering: crisp-edges;
    pointer-events: auto;
  }
  
  /* NOTE:
     If you ever see the canvas “shift” or blur, make sure you do NOT
     put CSS transforms on #renderCanvas or its parents. */
  
  /* =========================================================
     04 — TITLE
     ========================================================= */
  
  .site-header{
    position: fixed;
    top: var(--header-top);
    left: 50%;
    transform: translateX(-50%);
    z-index: 2;
  
    font-family: "Estonia", serif;
    font-size: 28px;
    letter-spacing: 0.15em;
    text-transform: lowercase;
    font-weight: 400;
  
    opacity: var(--fg-opacity);
    pointer-events: none;
    user-select: none;
  }
  
  @media (max-width: 480px){
    :root{ --header-top: 18px; }
  }
  
  /* =========================================================
     05 — NAV
     ========================================================= */
  
  .nav{
    position: fixed;
    inset: 0 0 auto 0;
    height: 56px;
    padding: 0 18px;
    z-index: 3;
  
    display: flex;
    align-items: center;
    justify-content: space-between;
  
    background: transparent;
    color: #fff;
  
    opacity: var(--fg-opacity);
  }
  
  .nav__brand{
    font-family: "Estonia", serif;
    font-size: 28px;
    letter-spacing: 0.12em;
    text-transform: lowercase;
    font-weight: 400;
  }
  
  .nav__links{
    display: flex;
    gap: 18px;
  }
  
  .nav a{
    font-family: "Estonia", serif;
    font-size: 22px;
    letter-spacing: 0.08em;
    text-transform: lowercase;
  
    color: inherit;
    text-decoration: none;
  
    opacity: 0.85;
    transition: opacity 120ms ease;
  }
  
  .nav a:hover{ opacity: 1; }
  
  @media (max-width: 640px){
    .nav{
      height: 52px;
      padding: 0 14px;
    }
    .nav a{
      font-size: 20px;
      letter-spacing: 0.05em;
    }
  }


  /* =========================================================
   07 — HANDWRITING
   ========================================================= */

   .handwriting{
    position: fixed;
    left: 275px;
    top: 80px;
    bottom: 40px;
    width: 320px;
  
    z-index: 10;                /* above tree + underlay */
    pointer-events: none;
  
    isolation: isolate;         /* isolate from blend/compositing */
    transform: translateZ(0);   /* force its own GPU layer */
    will-change: transform;
  
    opacity: 0.7;                 /* IMPORTANT: don’t fade the whole layer */
  }
  
  
  .handwriting__svg{
    width: 100%;
    height: 100%;
    overflow: visible; 
  }
  
  .hw{
    font-family: "Estonia", serif;
    font-size: 45px;
  
    fill: transparent;
    stroke: rgba(255,255,255,0.92);
    stroke-width: 1.3;
    stroke-linecap: round;
    stroke-linejoin: round;
  
    /* IMPORTANT: remove the filter that causes shimmer */
    filter: none;
  
    /* Optional: keep it crisp */
    shape-rendering: geometricPrecision;
  
    stroke-dasharray: 900;
    stroke-dashoffset: 900;
  
    animation:
      draw 40s ease-in-out forwards,
      fill 10s ease-in forwards;
  
    animation-delay:
      var(--d, 0s),
      calc(var(--d, 0s) + 32s);
  }


  .handwriting__svg{ position: relative; z-index: 1; }
  
  /* draw & fill animations */
  @keyframes draw{
    to{ stroke-dashoffset: 0; }
  }
  
  @keyframes fill{
    to{ fill: rgba(255,255,255,.18); }
  }
  
  /* =========================================================
     LINE-BY-LINE STAGGER
     ========================================================= */
  
  .handwriting__svg .hw:nth-of-type(1){ --d: 0s; }
  .handwriting__svg .hw:nth-of-type(2){ --d: 1s; }
  .handwriting__svg .hw:nth-of-type(3){ --d: 2s; }
  .handwriting__svg .hw:nth-of-type(4){ --d: 3s; }
  .handwriting__svg .hw:nth-of-type(5){ --d: 4s; }
  .handwriting__svg .hw:nth-of-type(6){ --d: 5s; }
  .handwriting__svg .hw:nth-of-type(7){ --d: 6s; }
  .handwriting__svg .hw:nth-of-type(8){ --d: 7s; }


  
/* =========================================================
   UNDERLAY — 2000s PAINT SPLATTER REVEAL + NEVER EMPTY
   Tuned: a bit MORE vibrant + noticeably LESS opacity loss (still moderate)
   ========================================================= */

   :root{
    /* two chunky splatter silhouettes (inline SVG masks) */
    --splatA: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'%3E%3Crect width='200' height='200' fill='black'/%3E%3Cpath fill='white' d='M86 18c12 8 9 22 22 28 10 5 23-2 30 8 7 11-7 19-2 30 6 12 23 9 27 21 5 14-12 21-14 34-2 14 12 22 5 33-9 14-26 1-41 8-12 6-12 22-26 25-15 3-18-16-31-18-14-2-24 13-35 6-14-9-1-26-8-41-6-12-23-12-25-26-3-15 16-18 18-31 2-14-13-24-6-35 8-13 23-2 34-14 10-10 7-26 18-33z'/%3E%3Ccircle cx='34' cy='68' r='10' fill='white'/%3E%3Ccircle cx='160' cy='52' r='8' fill='white'/%3E%3Ccircle cx='152' cy='162' r='12' fill='white'/%3E%3Ccircle cx='44' cy='152' r='7' fill='white'/%3E%3Ccircle cx='112' cy='176' r='6' fill='white'/%3E%3Ccircle cx='176' cy='108' r='5' fill='white'/%3E%3C/svg%3E");
    --splatB: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'%3E%3Crect width='200' height='200' fill='black'/%3E%3Cpath fill='white' d='M100 20c18 0 22 16 36 20 13 4 28-6 36 6 9 14-12 22-10 36 2 14 20 18 18 33-2 16-22 14-29 27-7 12 6 28-7 36-14 9-22-12-36-10-14 2-18 20-33 18-16-2-14-22-27-29-12-7-28 6-36-7-9-14 12-22 10-36-2-14-20-18-18-33 2-16 22-14 29-27 7-12-6-28 7-36 14-9 22 12 36 10 14-2 18-20 33-18z'/%3E%3Ccircle cx='22' cy='110' r='8' fill='white'/%3E%3Ccircle cx='178' cy='94' r='9' fill='white'/%3E%3Ccircle cx='56' cy='34' r='7' fill='white'/%3E%3Ccircle cx='150' cy='30' r='6' fill='white'/%3E%3Ccircle cx='40' cy='176' r='10' fill='white'/%3E%3Ccircle cx='168' cy='168' r='6' fill='white'/%3E%3C/svg%3E");
  
    /* TUNING KNOBS */
    --underlay-base-opacity: 0.26; /* was 0.22 (moderate bump) */
  }
  
  /* container */
  .underlay{
    position: fixed;
    inset: 0;
    z-index: 0;
    pointer-events: none;
    overflow: visible;
  }
  
  .underlay__window{
    position: absolute;
    inset: 0;
  }
  
  /* =========================================================
     KEYFRAMES
     ========================================================= */
  
  /* pop-on splatter reveal (mask grows + jitters in steps) */
  @keyframes splatMask{
    0%   { -webkit-mask-size: 1% 1%;     mask-size: 1% 1%;     -webkit-mask-position: 49% 52%; mask-position: 49% 52%; }
    4%   { -webkit-mask-size: 16% 16%;   mask-size: 16% 16%;   -webkit-mask-position: 52% 48%; mask-position: 52% 48%; }
    8%   { -webkit-mask-size: 68% 68%;   mask-size: 68% 68%;   -webkit-mask-position: 48% 53%; mask-position: 48% 53%; }
    12%  { -webkit-mask-size: 220% 220%; mask-size: 220% 220%; -webkit-mask-position: 51% 49%; mask-position: 51% 49%; }
    18%  { -webkit-mask-size: 170% 170%; mask-size: 170% 170%; -webkit-mask-position: 50% 50%; mask-position: 50% 50%; }
    100% { -webkit-mask-size: 170% 170%; mask-size: 170% 170%; -webkit-mask-position: 50% 50%; mask-position: 50% 50%; }
  }
  
  /* life cycle (opacity + drift) */
  @keyframes underlayLife{
    0%{
      opacity: 0;
      transform:
        translate3d(-50%, -50%, 0)
        translate3d(var(--tx, 0vw), var(--ty, 0vh), 0)
        rotate(calc(var(--r, 0deg) - 7deg))
        scale(calc(var(--s, 0.9) * 0.86));
      /* a touch punchier */
      filter: blur(1.8px) contrast(1.14) saturate(1.22);
    }
  
    /* wet hit */
    6%{
      opacity: var(--u, 0.20); /* slightly higher default */
      transform:
        translate3d(-50%, -50%, 0)
        translate3d(var(--tx, 0vw), var(--ty, 0vh), 0)
        rotate(var(--r, 0deg))
        scale(calc(var(--s, 0.9) * 1.10));
      /* more vibrancy on impact */
      filter: blur(0.75px) contrast(1.42) saturate(1.55);
    }
  
    /* settle */
    14%{
      opacity: var(--u, 0.20);
      transform:
        translate3d(-50%, -50%, 0)
        translate3d(var(--tx, 0vw), var(--ty, 0vh), 0)
        rotate(var(--r, 0deg))
        scale(var(--s, 0.9));
      filter: blur(0.40px) contrast(1.24) saturate(1.32);
    }
  
    /* hold */
    38%{
      opacity: var(--u, 0.20);
    }
  
    /* drift (LESS opacity loss than before) */
    75%{
      opacity: calc(var(--u, 0.20) * 0.90); /* was 0.78 */
      transform:
        translate3d(-50%, -50%, 0)
        translate3d(
          calc(var(--tx, 0vw) + var(--dx, 0px)),
          calc(var(--ty, 0vh) + var(--dy, 0px)),
          0
        )
        rotate(var(--r, 0deg))
        scale(var(--s, 0.9));
      /* keep it lively late in the cycle */
      filter: blur(0.50px) contrast(1.18) saturate(1.26);
    }
  
    /* dissolve */
    92%{
      opacity: 0;
      filter: blur(1.4px) contrast(1.06) saturate(1.10);
    }
  
    /* invisible reset */
    100%{
      opacity: 0;
      transform:
        translate3d(-50%, -50%, 0)
        translate3d(var(--tx, 0vw), var(--ty, 0vh), 0)
        rotate(var(--r, 0deg))
        scale(var(--s, 0.9));
      filter: blur(1.8px) contrast(1.10) saturate(1.18);
    }
  }
  
  /* slow ambient spin */
  @keyframes underlaySpin{
    from{ rotate: 0deg; }
    to{ rotate: calc(360deg * var(--dir, 1)); }
  }
  
  /* =========================================================
     IMAGE BASE
     ========================================================= */
  
  .underlay__img{
    position: absolute;
    left: 50%;
    top: 50%;
  
    width: 140vmax;
    height: 140vmax;
    object-fit: contain;
  
    /* slightly punchier blend */
    mix-blend-mode: screen;
  
    /* pick a splatter variant */
    --splat: var(--splatA);
    -webkit-mask-image: var(--splat);
    mask-image: var(--splat);
    -webkit-mask-repeat: no-repeat;
    mask-repeat: no-repeat;
    -webkit-mask-position: 50% 50%;
    mask-position: 50% 50%;
    -webkit-mask-size: 1% 1%;
    mask-size: 1% 1%;
  
    transform-origin: var(--ox, 50%) var(--oy, 50%);
    opacity: 0;
  
    /* defaults so it's never "gone" if JS isn't running */
    --u: 0.20;          /* was 0.18 */
    --lifeDur: 31s;
    --delay: 0s;
  
    --tx: 0vw; --ty: 0vh;
    --dx: 0px; --dy: 0px;
    --s: 0.9;  --r: 0deg;
  
    --dir: 1;
    --rotDur: 360s;
  
    animation:
      underlayLife var(--lifeDur) linear infinite,
      underlaySpin var(--rotDur) linear infinite,
      splatMask  var(--lifeDur) steps(9, end) infinite;
  
    animation-delay: var(--delay), 0s, var(--delay);
  
    will-change: transform, opacity, filter, -webkit-mask-size, -webkit-mask-position;
    backface-visibility: hidden;
  }
  
  /* alternate mask for variety */
  .underlay__img:nth-child(even){ --splat: var(--splatB); }
  
  /* =========================================================
     BASE COMPOSITION (works alone; your JS can override)
     ========================================================= */
  
  .underlay__img:nth-child(1){
    --u: calc(var(--underlay-base-opacity) * 1.05);
    --tx:-12vw; --ty:-8vh;
    --dx:220px; --dy:-180px;
    --s:.92; --r:-2deg;
    --ox:30%; --oy:32%;
    --dir:1; --rotDur:240s;
    --lifeDur: 29s;
    --delay:-2s;
  }
  .underlay__img:nth-child(2){
    --u: calc(var(--underlay-base-opacity) * 0.98);
    --tx:16vw; --ty:-10vh;
    --dx:-240px; --dy:200px;
    --s:.88; --r:3deg;
    --ox:72%; --oy:28%;
    --dir:-1; --rotDur:360s;
    --lifeDur: 33s;
    --delay:-9s;
  }
  .underlay__img:nth-child(3){
    --u: calc(var(--underlay-base-opacity) * 0.92);
    --tx:-6vw; --ty:14vh;
    --dx:180px; --dy:260px;
    --s:.86; --r:1deg;
    --ox:40%; --oy:78%;
    --dir:1; --rotDur:300s;
    --lifeDur: 26s;
    --delay:-14s;
  }
  .underlay__img:nth-child(4){
    --u: calc(var(--underlay-base-opacity) * 0.86);
    --tx:20vw; --ty:10vh;
    --dx:-260px; --dy:-200px;
    --s:.84; --r:-4deg;
    --ox:86%; --oy:54%;
    --dir:-1; --rotDur:480s;
    --lifeDur: 37s;
    --delay:-6s;
  }
  .underlay__img:nth-child(5){
    --u: calc(var(--underlay-base-opacity) * 0.78);
    --tx:2vw; --ty:0vh;
    --dx:210px; --dy:-170px;
    --s:.78; --r:-1deg;
    --ox:52%; --oy:52%;
    --dir:1; --rotDur:380s;
    --lifeDur: 24s;
    --delay:-18s;
  }
  .underlay__img:nth-child(6){
    --u: calc(var(--underlay-base-opacity) * 0.70);
    --tx:-18vw; --ty:18vh;
    --dx:-220px; --dy:190px;
    --s:.82; --r:4deg;
    --ox:18%; --oy:72%;
    --dir:-1; --rotDur:520s;
    --lifeDur: 41s;
    --delay:-11s;
  }
  .underlay__img:nth-child(7){
    --u: calc(var(--underlay-base-opacity) * 0.62);
    --tx:10vw; --ty:22vh;
    --dx:170px; --dy:-260px;
    --s:.80; --r:-2deg;
    --ox:64%; --oy:86%;
    --dir:1; --rotDur:460s;
    --lifeDur: 21s;
    --delay:-4s;
  }
  

  /* =========================================================
   AUDIO TOGGLE (matches nav)
   ========================================================= */
   .audio-toggle{
    position: fixed;
    top: 12px;
    left: 18px;
    z-index: 9999;          /* higher than nav/canvas/underlay */
    pointer-events: auto;   /* make sure it can be clicked */
  
    font-family: "Estonia", serif;
    font-size: 22px;
    letter-spacing: 0.08em;
    text-transform: lowercase;
  
    color: #fff;
    opacity: var(--fg-opacity);
    cursor: pointer;
    user-select: none;
  }
  
  .underlay,
  #renderCanvas{
    pointer-events: none;   /* ensures they never steal clicks */
  }
  

  #renderCanvas {
    pointer-events: none;
  }

  .handwriting {
    position: relative;
    z-index: 50;
    pointer-events: auto;
  }
  
  .handwriting__svg {
    pointer-events: auto;
  }
  
  .hw-link, .hw-link text {
    pointer-events: auto;
    cursor: pointer;
  }

  .handwriting__svg a {
    cursor: pointer;
  }
  
  .handwriting__svg a:hover text {
    text-decoration: underline;
  }



  .open-map-btn {



    position: fixed;
    top: var(--header-top);
    left: 334px;
    top: 680px;
    transform: translateX(-50%);
    z-index: 99999;
    font-family: "Estonia", serif;
    font-size: 28px;
    letter-spacing: 0.15em;
    text-transform: lowercase;
    font-weight: 400;
    opacity: 70%;
    user-select: none;
  }



  /* =========================================================
   MAP PAGE 
   ========================================================= */

   #bgVideo{
    position: fixed;
    inset: 0;
    width: 100vw;
    height: 100vh;
    object-fit: cover;
    object-position: center;
    z-index: -10;
    pointer-events: none;
    background: #000;
    
  }
  
  .map{
    width: 300px;
    height: auto; /* keeps aspect ratio */
    margin-top: 350px;
    margin-left: 150px;
    position: absolute;
    z-index: 1;
  
  }



.rose1{
    width: 200px;
    margin-top: 400px;
    margin-left: 1000px;
    position: absolute;
    z-index: 2;
    
}

.rose2{
    width: 200px;
    margin-top: 400px;
    margin-left: 1100px;
    position: absolute;
    z-index: 2;
    
}

.rose3{
    width: 200px;
    margin-top: 400px;
    margin-left: 1200px;
    position: absolute;
    z-index: 2;
    
}


.rose1, .rose2, .rose3, .map {
    filter:
      drop-shadow(1px 0 black)
      drop-shadow(-1px 0 black)
      drop-shadow(0 1px black)
      drop-shadow(0 -1px black);
}


.rose2,
.rose3 {
    filter: grayscale(100%);
}

.treemap {
    width: 200px;
    margin-top: 50px;
    margin-left: 1050px;
    position: absolute;
    z-index: 2;
}
  






/* =========================================================
   07B — MAP HANDWRITING (HOVER TRIGGERED)
   ========================================================= */

.handwriting-map{
  position: fixed;
  left: 35vw;
  top: 30vh;
  width: 300px;
  max-width: 86vw;

  z-index: 20;               /* above map + video */
  pointer-events: none;     /* text itself not interactive */

  isolation: isolate;
  transform: translateZ(0);
  will-change: transform;

  opacity: 0.8;
}

.handwriting-map__svg{
  width: 100%;
  height: auto;
  overflow: visible;
}

/* --- CLONED STYLE (SCOPED) --- */
.handwriting-map .hw{
  font-family: "Estonia", serif;
  font-size: 40px;

  fill: transparent;
  stroke: rgba(255,255,255,0.92);
  stroke-width: 1.3;
  stroke-linecap: round;
  stroke-linejoin: round;

  filter: none;
  shape-rendering: geometricPrecision;

  stroke-dasharray: 900;
  stroke-dashoffset: 900;

  /* IMPORTANT: paused until hover */
  animation:
    map-draw 36s ease-in-out forwards,
    map-fill 10s ease-in forwards;

  animation-delay:
    var(--d, 0s),
    calc(var(--d, 0s) + 28s);

  animation-play-state: running;
}

/* title slightly larger */
.handwriting-map .hw--2{
  font-size: 46px;
}

/* paragraphs slightly smaller */
.handwriting-map .hw--3,
.handwriting-map .hw--4,
.handwriting-map .hw--4b,
.handwriting-map .hw--5{
  font-size: 28px;
}



/* =========================================================
   KEYFRAMES (scoped so they don't collide)
   ========================================================= */

@keyframes map-draw{
  to{ stroke-dashoffset: 0; }
}

@keyframes map-fill{
  to{ fill: rgba(255,255,255,.18); }
}

/* =========================================================
   LINE STAGGER (same rhythm)
   ========================================================= */

.handwriting-map .hw:nth-of-type(1){ --d: 0s; }
.handwriting-map .hw:nth-of-type(2){ --d: 1s; }
.handwriting-map .hw:nth-of-type(3){ --d: 2s; }
.handwriting-map .hw:nth-of-type(4){ --d: 3s; }
.handwriting-map .hw:nth-of-type(5){ --d: 4s; }
.handwriting-map .hw:nth-of-type(6){ --d: 5s; }
.handwriting-map .hw:nth-of-type(7){ --d: 6s; }
.handwriting-map .hw:nth-of-type(8){ --d: 7s; }
